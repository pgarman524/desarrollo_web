<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>

    <!-- css bootstrap 533 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- bootstrapicons 1.11.3 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <style>
        #productos {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
    </style>

    <script>




    </script>
</head>

<body>
    <!-- Capa principal -->
    <div id="header" class="container">
        <!-- cabecera documento -->
        <header class="pb-3 mb-4 border-bottom">
            <!-- icono -->
            <i class="bi bi-shop fs-1"> </i>
            <h1>De todo...</h1>
            <b>Ejemplo cálculo de cesta o carrito de compra...</b>
            <span class="fs-1"></span>
        </header>

        <!-- Formulario -->
        <!-- <p class="h1">Solicitud Baja de Vehículos</p> -->


        <body>
            <div class="container mt-5">
                <div class="row">
                    <!-- Columna de los productos (izquierda) -->
                    <div class="col">
                        <div class="row" id="contProductos"></div>
                    </div>

                    <!-- Columna de la cesta (derecha) -->
                    <div id="cesta" class="col-sm-4">

                        <!-- Icono y título de la cesta -->
                        <div class="d-flex align-items-center mb-4">
                            <i class="bi bi-basket2-fill fs-1 me-3"></i>
                            <h1 class="h3 mb-0">Cesta</h1>
                        </div>

                        <!-- Tabla Cesta -->
                        <table class="table table-bordered">
                            <thead class="table-light">
                                <tr>
                                    <th scope="col">ID</th>
                                    <th scope="col">Nombre</th>
                                    <th scope="col">Cantidad</th>
                                    <th scope="col">Precio</th>
                                    <th scope="col">Retirar</th>
                                </tr>
                            </thead>
                            <tbody id="cestaProductos">
                                <!-- Aquí se agregarán los productos seleccionados en la cesta -->

                            </tbody>
                        </table>

                        <!-- Resumen cesta -->
                        <div class="d-flex justify-content-between border-top pt-3">

                            <div>
                                <h5 class="mb-0">Precio:</h5>
                                <p id="precioTotal"></p>
                            </div>
                            <div>
                                <h5 class="mb-0">IVA (21%):</h5>
                                <p id="ivaTotal"></p>
                            </div>
                            <div>
                                <h5 class="cart-total-price">Total:</h5>
                                <p class="fw-bold" id="totalFinal"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </body>

        <script>
            class Producto {
                #producto = {};
                constructor(cod, imagen, nombre, precio, unidades) {
                    this.#producto.cod = cod;
                    this.#producto.imagen = imagen;
                    this.#producto.nombre = nombre;
                    this.#producto.precio = precio;
                    return this.#producto;
                }
            }



            class ContProductos {
                #cesta = [];


                constructor() {
                    this.creadorTarjetas();
                    //this.#cesta = cesta(productos);
                }

                creadorTarjetas() {
                    var contenedor = document.getElementById("contProductos")

                    // Bucle para itinerar el array
                    productos.forEach(producto => {
                        var columna01 = document.createElement("div");
                        columna01.setAttribute("class", "col-sm-4 mb-4")

                        var columna02 = document.createElement("div");
                        columna02.setAttribute("class", "card");
                        columna02.setAttribute("style", "width: 10rem;");

                        var imagen = document.createElement("img");
                        imagen.setAttribute("class", "card-img-top");
                        imagen.setAttribute("src", producto.imagen);
                        imagen.setAttribute("alt", "Imagen del producto");

                        var columna03 = document.createElement("div");
                        columna03.setAttribute("class", "card-body");

                        var h5 = document.createElement("h5");
                        h5.setAttribute("class", "card-title");
                        h5.textContent = producto.nombre;

                        var p = document.createElement("p");
                        p.setAttribute("class", "card-text");
                        p.textContent = producto.precio + " €";

                        var divCantidad = document.createElement("div");
                        divCantidad.setAttribute("class", "mb-3");

                        var labelCantidad = document.createElement("label");
                        labelCantidad.setAttribute("for", "cantidad");
                        labelCantidad.textContent = "Cantidad";

                        var inputCantidad = document.createElement("input");
                        inputCantidad.setAttribute("type", "number");
                        inputCantidad.setAttribute("class", "form-control");
                        inputCantidad.setAttribute("id", "cantidad");
                        inputCantidad.setAttribute("placeholder", "0");

                        var boton = document.createElement("a");
                        boton.setAttribute("class", "btn btn-primary");
                        boton.textContent = "Añadir";
                        //boton.addEventListener('click', this.#cesta.anadirCesta.bind(this.#cesta, info['id']));


                        // Estructura final de la tarjeta
                        contenedor.appendChild(columna01);
                        columna01.appendChild(columna02);
                        columna02.appendChild(imagen);
                        columna02.appendChild(columna03);
                        columna03.appendChild(h5);
                        columna03.appendChild(p);
                        columna03.appendChild(divCantidad);
                        divCantidad.appendChild(inputCantidad);
                        columna03.appendChild(boton);
                    });
                }

            }

            class Cesta {
                #cesta = [];

                constructor() {
                    this.#cesta = [];
                }


                creadorTarjetaCesta() {
                    this.#cesta.forEach(producto => {
                        var columna01 = document.createElement("tr");

                        var idColumna = document.createElement("th");
                        idColumna.textContent(producto.nombre)
                        //idColumna.setAttribute("id", "id");

                        var nombreColumna = document.createElement("th");
                        nombreColumna.textContent(producto.nombre);

                        var cantidadColumna = document.createElement("th");
                        cantidadColumna.textContent(producto.cantidad)
                        //cantidadColumna.setAttribute("id", "cantidad");

                        var precioColumna = document.createElement("th");
                        precioColumna.textContent(producto.precio);
                        //precioColumna.setAttribute("id", "precio");

                        var botonColumna = document.createElement("th");

                        var boton = document.createElement("a");
                        boton.setAttribute("class", "btn btn-danger");
                        boton.textContent = "X";

                        contenedor.appendChild(columna01);
                        columna01.appendChild(idColumna);
                        idColumna.appendChild(nombreColumna);
                        idColumna.appendChild(cantidadColumna);
                        idColumna.appendChild(precioColumna);
                        idColumna.appendChild(botonColumna);
                        botonColumna.appendChild(boton)


                        /*
                                <tr class="cart-row">
                                    <td class="cart-items">1</td>
                                    <td>Pantalón</td>
                                    <td class="cart-quantity-input">2</td>
                                    <td class="cart-price">12</td>
                                    <td>
                                        <button type="button" class="btn btn-danger">Danger</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>1</td>
                                    <td>Pantalón</td>
                                    <td>2</td>
                                    <td>12</td>
                                    <td>
                                        <button type="button" class="btn btn-danger">Danger</button>
                                    </td>
                                </tr>
                        */
                    })

                    botonanadir = boton.addEventListener('click', this.#cesta.addCesta.bind(this.#cesta, info['id']));


                }
                /*
                                // Al final necesito hacer push al objeto que creo en la cesta? O solo cuando haces onclick en el botón añadir...
                                eliminarBoton() {
                                    var removeButton = document.getElementsByClassName('btn-danger');
                
                                    // Para verificar que está cogiendo los datos
                                    //console.log(removeButton);
                
                                    // los botonos ahora son parte de un array de clase btn-danger
                                    for (let i = 0; i < removeButton.length; i++) {
                                        //cogemos el botón con su id
                                        var button = removeButton[i];
                                        // al hacer click llamamos a un evento que elimine la línea seleccionada con el id
                                        button.addEventListener('click', function (event) {
                                            let buttonClick = event.target;
                                            buttonClick.parentElement.parentElement.remove()
                                        })
                                    }
                                }
                
                
                                updateDineroTotal() {
                                    let carritoObjetoCont = document.getElementsByClassName('cart-items')[0];
                                    let cartRows = carritoObjetoCont.getElementsByClassName('cart-row');
                
                                    let total = 0
                
                                    for (let i = 0; i < cartRows.length; i++) {
                                        let carritoFila = cartRows[i];
                
                                        let precioItem = carritoFila.getElementsByClassName('cart-price')[0];
                                        let cantidadItem = carritoFila.getElementsByClassName('cart-quantity-input')[0];
                
                                        // transformo el precio en float y le añado el símbolo del € al final
                                        let precio = parseFloat(precioItem.innerText.replace('€', ''));
                                        let cantidad = cantidadItem.value;
                                        let iva = precio * 0.21;
                                        console.log(precio);
                                        total += ((precio + iva) * cantidad);
                                    }
                                    document.getElementsByClassName('cart-total-price')[0].innerText = total + ' €';
                                }
                
                                // Esto de aqué  sirve para algo pero no sé
                                // let cant=document.querySelector("input[data-inudi='"+idBot"']");
                
                
                */

                // necesito hacer un reset a la cesta cuando añado algo al array o cuando elimino algo del array de la cesta

                anadirCesta(producto) {
                    this.#cesta.push(producto);
                    this.creadorTarjetaCesta();
                }

                mostrarCesta() {
                    this.creadorTarjetaCesta();
                }

                //Necesito un método para contar el precio a mostrar, el total, el iva y el sumado

                mostrarPrecio(cantidad) {
                    /*
                    total = cantidad * producto.precio;
                    iva = producto.precio * 0, 21;

                    precioTotal = total + iva;
                    */
                }


            }

            var productos = [
                {
                    id: 1,
                    imagen: "https://media.istockphoto.com/id/979468674/es/foto/deportes-zapatos-closeup.jpg?s=2048x2048&w=is&k=20&c=dZd4dvoJ6Dk_YdtwWyh0pT8Pov1y4FiRk62s3MOS9NY=",
                    nombre: "Zapatos",
                    precio: 10
                },
                {
                    id: 2,
                    imagen: "https://cdn.pixabay.com/photo/2017/09/03/14/41/mock-up-2710535_1280.jpg",
                    nombre: "Camisa",
                    precio: 25
                },
                {
                    id: 3,
                    imagen: "https://media.istockphoto.com/id/1499371307/es/foto/reloj-de-pulsera-vintage-de-lujo-en-el-brazo-del-hombre-de-cerca.jpg?s=2048x2048&w=is&k=20&c=zOATEIJURLTUboxUWRiB0ipE177UHzIhPPTpnk0lMd0=",
                    nombre: "Reloj",
                    precio: 115
                },
                {
                    id: 4,
                    imagen: "https://media.istockphoto.com/id/516134632/es/foto/cadena-de-oro-con-diamantes-s%C3%ADmbolo-del-d%C3%B3lar.jpg?s=2048x2048&w=is&k=20&c=uBipa2D0TYJ5WmR7rfwXAwIxCm1sAHJLQ0ggETwm4VE=",
                    nombre: "Collar",
                    precio: 355
                },
                {
                    id: 5,
                    imagen: "https://media.istockphoto.com/id/509638316/es/foto/anillos-de-boda-de-oro.jpg?s=2048x2048&w=is&k=20&c=Zm9E_0ScX4EioMVYZoeRVEkEghsYwH6FhxG2Gi6MzIE=",
                    nombre: "anillos",
                    precio: 85
                },
                {
                    id: 6,
                    imagen: "https://media.istockphoto.com/id/173239968/es/foto/fino-herm%C3%A9tico-jeans-azul-sobre-fondo-blanco.jpg?s=2048x2048&w=is&k=20&c=iWnXptKP5xr_QwJMkGO2lTGRX9a4MpQtswm6ZpMhwPs=",
                    nombre: "Pantalón",
                    precio: 15
                }
            ];

            // Instancia lista de productos
            window.onload = () => new ContProductos(productos);
            //window.onload = () => new Cesta(cesta);

            cesta = new Cesta();

            cesta.eliminarBoton();
            cesta.updateDineroTotal();
        </script>
        </form>
    </div>

    <!-- Pie del documento -->
    <footer class="footer mt-auto py-3 fixed-bottom bg-light">
        <div class="container">
            <span class="text-muted">
                ©2024 Pablo García Mangana - DWES - 2º DAW - Curso 24/25
            </span>
        </div>
    </footer>



    </div>
    <!-- javascript bootstrap 533-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>




</body>

</html>